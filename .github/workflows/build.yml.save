name: Build Game

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install SFML
      run: |
        git clone https://github.com/SFML/SFML.git
        cd SFML
        git checkout 3.0.2
        mkdir build
        cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=C:/SFML -DBUILD_SHARED_LIBS=OFF
        cmake --build . --config Release --target install
    
    - name: Configure CMake
      run: |
        mkdir build
        cd build
        cmake .. -DCMAKE_PREFIX_PATH=C:/SFML -DSFML_STATIC_LIBRARIES=TRUE
    
    - name: Build
      run: |
        cd build
        cmake --build . --config Release
    
    - name: Upload Windows Executable
      uses: actions/upload-artifact@v3
      with:
        name: game-windows
        path: build/Release/game.exe

  build-linux:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y git cmake build-essential \
          libfreetype6-dev libopenal-dev libflac-dev \
          libvorbis-dev libgl1-mesa-dev libudev-dev \
          libxrandr-dev libxcursor-dev libxi-dev
    
    - name: Install SFML
      run: |
        git clone https://github.com/SFML/SFML.git
        cd SFML
        git checkout 3.0.2
        mkdir build && cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local -DBUILD_SHARED_LIBS=OFF
        make -j$(nproc)
        sudo make install
        sudo ldconfig
    
    - name: Build Game
      run: |
        mkdir build
        cd build
        cmake ..
        make
    
    - name: Upload Linux Executable
      uses: actions/upload-artifact@v3
      with:
        name: game-linux
        path: build/game

